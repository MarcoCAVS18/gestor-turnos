// src/components/settings/DeliverySection/index.jsx
import React from 'react';
import { Truck, Info, Package, DollarSign } from 'lucide-react';
import { useApp } from '../../../contexts/AppContext';
import SettingsSection from '../SettingsSection';
import Switch from '../../ui/Switch';

const DeliverySection = ({ onError, onSuccess }) => {
  const { deliveryEnabled, guardarPreferencias, coloresTem√°ticos } = useApp();
  
  console.log('DeliverySection - deliveryEnabled:', deliveryEnabled);
  
  const handleToggle = async (checked) => {
    console.log('DeliverySection - handleToggle called with:', checked);
    try {
      await guardarPreferencias({ deliveryEnabled: checked });
      console.log('DeliverySection - guardarPreferencias success');
      onSuccess?.(`Modo delivery ${checked ? 'activado' : 'desactivado'}`);
    } catch (error) {
      console.error('DeliverySection - Error:', error);
      onError?.('Error al cambiar configuraci√≥n de delivery');
    }
  };

  return (
    <SettingsSection icon={Truck} title="Trabajos de Delivery">
      <div className="space-y-4">
        {/* Toggle principal */}
        <div className="flex items-center justify-between">
          <div className="flex-1">
            <p className="font-medium">Habilitar modo delivery</p>
            <p className="text-sm text-gray-500">
              Permite registrar trabajos de reparto con ganancias variables
            </p>
          </div>
          <Switch
            checked={deliveryEnabled}
            onChange={handleToggle}
          />
        </div>
        
        {/* Informaci√≥n cuando est√° activado */}
        {deliveryEnabled && (
          <>
            <div 
              className="p-4 rounded-lg border"
              style={{ 
                backgroundColor: coloresTem√°ticos?.transparent5 || 'rgba(236, 72, 153, 0.05)',
                borderColor: coloresTem√°ticos?.transparent20 || 'rgba(236, 72, 153, 0.2)'
              }}
            >
              <div className="flex items-start">
                <Info size={16} className="mt-0.5 mr-2 flex-shrink-0" style={{ color: coloresTem√°ticos?.base }} />
                <div className="text-sm space-y-1">
                  <p className="font-medium">¬øC√≥mo funciona?</p>
                  <ul className="space-y-1 text-gray-600">
                    <li>‚Ä¢ Los trabajos de delivery no requieren tarifa por hora</li>
                    <li>‚Ä¢ Registra tus ganancias totales por cada turno</li>
                    <li>‚Ä¢ Incluye propinas y cantidad de pedidos realizados</li>
                    <li>‚Ä¢ Opcionalmente agrega kil√≥metros y gastos de combustible</li>
                  </ul>
                </div>
              </div>
            </div>

            {/* Plataformas soportadas */}
            <div>
              <p className="text-sm font-medium text-gray-700 mb-3">Plataformas soportadas:</p>
              <div className="grid grid-cols-2 gap-2">
                {[
                  { nombre: 'Uber Eats', icono: 'üöó' },
                  { nombre: 'DoorDash', icono: 'üõµ' },
                  { nombre: 'Rappi', icono: 'üì¶' },
                  { nombre: 'PedidosYa', icono: 'üèçÔ∏è' }
                ].map(plataforma => (
                  <div key={plataforma.nombre} className="flex items-center p-2 bg-gray-50 rounded-lg">
                    <span className="text-xl mr-2">{plataforma.icono}</span>
                    <span className="text-sm">{plataforma.nombre}</span>
                  </div>
                ))}
              </div>
              <p className="text-xs text-gray-500 mt-2">
                Tambi√©n puedes agregar plataformas personalizadas
              </p>
            </div>

            {/* Estad√≠sticas preview */}
            <div className="border-t pt-4">
              <p className="text-sm font-medium text-gray-700 mb-2">
                Con el modo delivery podr√°s ver:
              </p>
              <div className="space-y-2">
                <div className="flex items-center text-sm text-gray-600">
                  <DollarSign size={16} className="mr-2 text-green-500" />
                  Ganancia promedio por pedido
                </div>
                <div className="flex items-center text-sm text-gray-600">
                  <Package size={16} className="mr-2 text-blue-500" />
                  Total de pedidos completados
                </div>
                <div className="flex items-center text-sm text-gray-600">
                  <Truck size={16} className="mr-2 text-purple-500" />
                  Kil√≥metros recorridos y gastos
                </div>
              </div>
            </div>
          </>
        )}
      </div>
    </SettingsSection>
  );
};

export default DeliverySection;